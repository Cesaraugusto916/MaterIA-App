# üß† Aula 07 ‚Äî Organizadores de Dados: Ordenando e Agrupando

## üéì Ol√°, Aventureiro\!

Na nossa √∫ltima aula, voc√™ se tornou um mestre da filtragem, usando m√°scaras booleanas para encontrar exatamente o que precisava nos seus dados. Mas e se a sua pergunta for: "Qual produto vendeu mais?" ou "Qual a loja com a maior m√©dia de vendas?". A filtragem pura n√£o √© suficiente.

Esta aula vai te dar as ferramentas para responder a essas perguntas. Vamos aprender a organizar e resumir os dados, transformando-os de uma lista ca√≥tica em resumos claros e poderosos.

  - **Tema Central**: Organiza√ß√£o e agrega√ß√£o de dados
  - **Comando(s) Essencial(is)**: `df.sort_values()`, `df.groupby()`, `agg()`

-----

# üìç Da Desordem ao Resumo: A L√≥gica da An√°lise

Pense na an√°lise de dados como a organiza√ß√£o de uma biblioteca. Primeiro, voc√™ importa os livros. Depois, voc√™ os inspeciona e os filtra (Aula 06). Mas para realmente encontrar os mais populares ou entender a cole√ß√£o por g√™nero, voc√™ precisa de duas a√ß√µes fundamentais:

1.  **Ordenar**: Colocar os livros em ordem alfab√©tica ou por n√∫mero de empr√©stimos. No Pandas, isso √© feito com **`sort_values()`**.
2.  **Agrupar e Resumir**: Juntar todos os livros de "Fic√ß√£o Cient√≠fica" e contar quantos s√£o, ou somar suas p√°ginas. No Pandas, isso √© feito com **`groupby()`** e **`agg()`**.

Dominar essas t√©cnicas √© o que permite extrair insights reais dos seus dados, transformando-os em informa√ß√µes √∫teis para a tomada de decis√µes.

-----

# üìö Conte√∫do Explicado: As Ferramentas de Organiza√ß√£o

### 1\. `sort_values()`: Colocando a Casa em Ordem

A fun√ß√£o `sort_values()` √© a forma do Pandas de arrumar a bagun√ßa. Ela reorganiza todo o seu DataFrame com base nos valores de uma ou mais colunas, como se voc√™ estivesse clicando no cabe√ßalho de uma planilha para ordenar.

  - **`by='coluna'`**: O par√¢metro `by` √© onde voc√™ especifica a coluna que ser√° o crit√©rio de ordena√ß√£o. Voc√™ pode passar uma lista de colunas, e o Pandas ordenar√° pela primeira, depois pela segunda, e assim por diante.
  - **`ascending=True`**: Este par√¢metro define a dire√ß√£o da ordena√ß√£o. O padr√£o √© `True` (crescente), mas para ver os maiores valores primeiro, voc√™ usar√° `False` (decrescente).

-----

### 2\. `groupby()`: O Poder de Agrupar

O `groupby()` √© a fun√ß√£o mais poderosa para sumarizar dados. Ele n√£o faz nada sozinho, mas cria um "objeto de grupos" que serve como um intermedi√°rio. Pense nele como uma "organizador de caixas": ele pega todas as linhas do seu DataFrame e as separa em caixas, com base nos valores da coluna que voc√™ escolheu. Cada caixa √© um grupo.

Por exemplo, se voc√™ agrupa por `'loja'`, o Pandas criar√° uma "caixa" para a loja 'SP', outra para a 'RJ', e assim por diante.

-----

### 3\. `agg()`: Resumindo os Grupos

Depois de agrupar, voc√™ precisa dizer ao Pandas o que fazer com cada grupo. √â a√≠ que entra o **`agg()`** (de "aggregate"). Ele aplica uma ou mais fun√ß√µes de agrega√ß√£o (como soma, m√©dia, contagem) aos dados em cada uma dessas "caixas" criadas pelo `groupby()`.

A sintaxe mais flex√≠vel de `agg()` usa um dicion√°rio: `{ 'coluna_para_resumir': 'fun√ß√£o' }`. Voc√™ pode aplicar diferentes fun√ß√µes a diferentes colunas em uma √∫nica opera√ß√£o\!

  - `'sum'`: soma os valores de cada grupo.
  - `'mean'`: calcula a m√©dia de cada grupo.
  - `'max'`: encontra o valor m√°ximo de cada grupo.
  - `'count'`: conta o n√∫mero de itens em cada grupo.

-----

## üìà Exemplos Pr√°ticos: M√£o na Massa

Vamos usar um DataFrame de exemplo para colocar a teoria em pr√°tica.

```python
import pandas as pd

df = pd.DataFrame({
    'produto': ['A', 'B', 'A', 'C', 'B'],
    'vendas': [100, 200, 150, 300, 250]
})

print("--- DataFrame original ---")
print(df)
print("\n")

# Ordenar por vendas decrescentes
ordenado = df.sort_values(by='vendas', ascending=False)
print("--- DataFrame ordenado por vendas (decrescente) ---")
print(ordenado)
print("\n")

# Agrupar por produto e somar vendas
agrupado = df.groupby('produto').agg({'vendas': 'sum'})
print("--- Vendas totais agrupadas por produto ---")
print(agrupado)
```

**O que aconteceu?**
Primeiro, `sort_values()` nos mostrou rapidamente que o produto 'C' teve a maior venda. Depois, `groupby()` e `agg()` nos deram um resumo ainda mais poderoso, somando as vendas de cada produto e apresentando o total.

-----

## üß™ Demonstra√ß√£o Aplicada: Resolvendo um Problema Real

Imagine que voc√™ tem um DataFrame de vendas por loja e quer responder a duas perguntas importantes para o seu gestor:

1.  Quais lojas tiveram as maiores vendas em uma √∫nica transa√ß√£o?
2.  Qual foi a soma e a m√©dia das vendas de cada loja?

<!-- end list -->

```python
df = pd.DataFrame({
    'loja': ['SP', 'RJ', 'SP', 'MG', 'RJ', 'MG'],
    'vendas': [300, 200, 400, 150, 250, 350]
})

print("--- DataFrame original ---")
print(df)
print("\n")

# 1. Ordenar por vendas para ver a maior transa√ß√£o
df_ordenado = df.sort_values(by='vendas', ascending=False)
print("--- Maiores vendas (top 3 transa√ß√µes) ---")
print(df_ordenado.head(3))
print("\n")

# 2. Agrupar por loja e calcular soma e m√©dia
df_agrupado = df.groupby('loja').agg({
    'vendas': ['sum', 'mean']
})
print("--- Vendas totais e m√©dias por loja ---")
print(df_agrupado)
```

**O que aprendemos com a demonstra√ß√£o?**

  - `sort_values()` foi a forma mais f√°cil de encontrar a maior venda individual: uma transa√ß√£o de R$ 400 na loja `SP`.
  - `groupby()` e `agg()` foram perfeitos para resumir os dados e nos dizer que a loja `MG` teve um total de R$ 500 em vendas e uma m√©dia de R$ 250 por transa√ß√£o.

-----

## üìé Dicas e Armadilhas: O que o Profissional Faz

  - **Limpeza √© fundamental**: Antes de agrupar, certifique-se de que a coluna que voc√™ est√° usando em `groupby()` est√° limpa e consistente. Por exemplo, se a coluna `loja` tiver `'sp'` e `'SP'`, o Pandas tratar√° como dois grupos diferentes\!
  - **`.reset_index()`**: O resultado de um `groupby()` transforma a coluna de agrupamento em um novo √≠ndice. Se voc√™ precisar que essa coluna volte a ser uma coluna normal, use `.reset_index()` no DataFrame resultante.
  - **`sort_values()` depois do `groupby()`**: √â uma pr√°tica comum agrupar e depois ordenar o resultado para visualizar rapidamente os grupos com os maiores (ou menores) valores.

-----

## üîÑ Transi√ß√µes e Conex√µes

  - **Vem de**: A aula anterior, onde voc√™ aprendeu a filtrar informa√ß√µes. A ordena√ß√£o e a agrega√ß√£o s√£o o pr√≥ximo passo l√≥gico. Voc√™ filtra os dados que s√£o relevantes, e ent√£o os ordena ou agrupa para extrair os insights.
  - **Vai para**: A pr√≥xima aula, que ser√° uma transi√ß√£o para o mundo dos dados num√©ricos. Vamos explorar o **Numpy**, a biblioteca por tr√°s do Pandas, para entender como o Pandas manipula grandes volumes de dados de forma eficiente.

-----

## üé® Recursos Visuais e Mentais (Para Pensar)

1.  **Ordena√ß√£o como um ranking**: Pense no `sort_values()` como a cria√ß√£o de um ranking, do maior para o menor, ou vice-versa.
2.  **Agrupamento como caixas**: Imagine o `groupby()` como o ato de separar objetos em caixas com base em alguma caracter√≠stica. O `agg()` √© o que voc√™ faz com o conte√∫do de cada caixa (soma, conta, etc.).
3.  **Fluxo de An√°lise Avan√ßado**: Importar ‚Üí Explorar ‚Üí Filtrar ‚Üí **Agrupar/Ordenar (esta aula)** ‚Üí Analisar/Visualizar.

-----

Voc√™ agora tem o poder de organizar e resumir grandes conjuntos de dados. Essa habilidade √© a base de qualquer relat√≥rio e an√°lise estat√≠stica.

Pronto para entender a matem√°tica por tr√°s de tudo isso?

---

# üß™ Exerc√≠cios

## üß© Parte 1: Ordenando com `sort_values()`

1. **Leia o arquivo `vendas.csv` e ordene o DataFrame pela coluna `'valor'` em ordem crescente.**

2. **Ordene o DataFrame `clientes.csv` pela coluna `'idade'` em ordem decrescente.**

3. **Ordene o DataFrame `produtos.csv` pela coluna `'preco'` e exiba apenas os 5 primeiros produtos mais caros.**

4. **Ordene o DataFrame `relatorio.csv` por `'data'` para visualizar os registros mais recentes no final.**

5. **Ordene o DataFrame `funcionarios.csv` por `'salario'` e depois por `'departamento'`.**

---

## üîç Parte 2: Agrupando com `groupby()`

6. **Agrupe o DataFrame `vendas.csv` por `'loja'` e calcule a soma das vendas por loja.**

7. **Agrupe o DataFrame `clientes.csv` por `'estado'` e conte quantos clientes h√° em cada estado.**

8. **Agrupe o DataFrame `produtos.csv` por `'categoria'` e calcule o pre√ßo m√©dio por categoria.**

9. **Agrupe o DataFrame `relatorio.csv` por `'status'` e calcule a m√©dia de `'valor'` para cada status.**

10. **Agrupe o DataFrame `funcionarios.csv` por `'cargo'` e exiba o maior sal√°rio de cada cargo.**

---

## üß± Parte 3: Agregando com `agg()`

11. **Agrupe o DataFrame `vendas.csv` por `'loja'` e calcule a soma e a m√©dia das vendas usando `agg()`.**

12. **Agrupe o DataFrame `clientes.csv` por `'estado'` e calcule a idade m√≠nima e m√°xima.**

13. **Agrupe o DataFrame `produtos.csv` por `'categoria'` e calcule a contagem e o pre√ßo m√©dio.**

14. **Agrupe o DataFrame `relatorio.csv` por `'status'` e calcule a soma, m√©dia e contagem de `'valor'`.**

15. **Agrupe o DataFrame `funcionarios.csv` por `'departamento'` e calcule a m√©dia de `'salario'` e a contagem de funcion√°rios.**

---

## üßº Parte 4: Combina√ß√µes e Ajustes

16. **Agrupe o DataFrame `vendas.csv` por `'loja'`, calcule a soma das vendas e ordene o resultado em ordem decrescente.**

17. **Agrupe o DataFrame `clientes.csv` por `'estado'`, calcule a m√©dia de idade e ordene do mais velho para o mais novo.**

18. **Agrupe o DataFrame `produtos.csv` por `'categoria'`, calcule o pre√ßo m√©dio e ordene da categoria mais cara para a mais barata.**

19. **Agrupe o DataFrame `relatorio.csv` por `'status'`, calcule a soma de `'valor'` e exiba apenas os status com soma acima de 1000.**

20. **Agrupe o DataFrame `funcionarios.csv` por `'cargo'`, calcule o sal√°rio m√©dio e use `.reset_index()` para transformar o √≠ndice em coluna.**

---