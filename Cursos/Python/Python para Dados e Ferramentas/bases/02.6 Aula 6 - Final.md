# ğŸ§  Aula 06 â€” O Superfiltro: Encontrando InformaÃ§Ãµes com MÃ¡scaras

## ğŸ“ OlÃ¡, Aventureiro\!

Na Ãºltima aula, vocÃª se tornou um mestre em usar a bÃºssola (`.loc[]` e `.iloc[]`) para encontrar qualquer ponto em seu mapa de dados. Mas e se a pergunta for diferente? Em vez de "O que estÃ¡ no ponto (X, Y)?", e se a pergunta for "Quais sÃ£o todos os pontos com a caracterÃ­stica Z?".

Esta aula vai te dar esse poder. Vamos aprender a usar **filtros lÃ³gicos** para selecionar linhas de um DataFrame que atendam a critÃ©rios especÃ­ficos. Ã‰ como usar um filtro em uma planilha, mas com a superpotÃªncia e precisÃ£o do Python.

  - **Tema Central**: CondiÃ§Ãµes e mÃ¡scaras para filtrar dados
  - **Comando(s) Essencial(is)**: `df[condiÃ§Ã£o]`, `df.loc[condiÃ§Ã£o]`, operadores lÃ³gicos (`&`, `|`, `~`), `.isin()`, `.between()`

-----

# ğŸ“ A Magia da MÃ¡scara Booleana: Sim ou NÃ£o?

No coraÃ§Ã£o da filtragem com Pandas estÃ¡ o conceito de **mÃ¡scara booleana**. Pense nela como uma lista de `True` e `False` com o mesmo nÃºmero de linhas do seu DataFrame. O `True` diz "mantenha esta linha" e o `False` diz "ignore esta linha".

Quando vocÃª escreve uma condiÃ§Ã£o, como `df['vendas'] > 300`, o Pandas nÃ£o te dÃ¡ um Ãºnico resultado. Ele te dÃ¡ essa mÃ¡scara booleana:

```
0    False
1    False
2    False
3     True
4     True
Name: vendas, dtype: bool
```

Depois, vocÃª passa essa mÃ¡scara para o DataFrame, e ele magicamente retorna apenas as linhas que correspondem ao valor `True`. Entender isso Ã© a chave para dominar a filtragem.

-----

# ğŸ“š ConteÃºdo Explicado: As Ferramentas de Filtragem

### 1\. A Filtragem Simples e Direta

A sintaxe mais comum e direta para filtrar Ã© aninhar a condiÃ§Ã£o dentro dos colchetes do DataFrame.

```python
# A condiÃ§Ã£o `df['coluna'] > valor` gera a mÃ¡scara booleana.
# O DataFrame `df` usa essa mÃ¡scara para retornar as linhas desejadas.
df[df['coluna'] > valor]
```

### 2\. A Filtragem com `loc[]`: Combinando Poderes

VocÃª jÃ¡ Ã© um mestre em `loc[]`. Agora, vamos combinÃ¡-lo com a filtragem\! Em vez de passar um rÃ³tulo, vocÃª passa a sua mÃ¡scara booleana. Isso te dÃ¡ a flexibilidade de filtrar as linhas e, ao mesmo tempo, selecionar colunas especÃ­ficas.

```python
# Passamos a mÃ¡scara booleana como o seletor de linhas
df.loc[df['coluna'] == 'valor', ['coluna_a', 'coluna_b']]
```

### 3\. Conectando as Ideias: Operadores LÃ³gicos

A vida raramente se resume a uma Ãºnica condiÃ§Ã£o. E se vocÃª quiser encontrar as vendas que sejam "maiores que R$ 300 **E** da loja 'A'"? Ã‰ aqui que os operadores lÃ³gicos entram em cena.

  - `&` (E): Ambas as condiÃ§Ãµes devem ser verdadeiras.
  - `|` (OU): Pelo menos uma das condiÃ§Ãµes deve ser verdadeira.
  - `~` (NÃƒO): Inverte a condiÃ§Ã£o.
  - **AtenÃ§Ã£o\!** Quando vocÃª combina condiÃ§Ãµes, Ã© **obrigatÃ³rio** envolvÃª-las em parÃªnteses. `(condiÃ§Ã£o_1) & (condiÃ§Ã£o_2)`.

-----

### 4\. Atalhos Poderosos: `isin()` e `between()`

O Pandas oferece mÃ©todos especiais que tornam a escrita de filtros complexos muito mais fÃ¡cil e legÃ­vel.

  - **`.isin()`**: Perfeito para verificar se um valor estÃ¡ em uma lista de opÃ§Ãµes. Ã‰ muito mais limpo do que escrever `(coluna == 'valor1') | (coluna == 'valor2')`.

    ```python
    # Filtra por produtos que sÃ£o 'A' OU 'B'
    df[df['categoria'].isin(['A', 'B'])]
    ```

  - **`.between()`**: Ideal para filtrar valores que estÃ£o dentro de um intervalo, como `maior ou igual a X` e `menor ou igual a Y`.

    ```python
    # Filtra preÃ§os entre 10 e 50 (incluindo 10 e 50)
    df[df['preco'].between(10, 50)]
    ```

-----

## ğŸ“ˆ Exemplos PrÃ¡ticos: MÃ£o na Massa

Vamos usar um DataFrame simples para praticar a filtragem.

```python
import pandas as pd

df = pd.DataFrame({
    'produto': ['A', 'B', 'C', 'D'],
    'preco': [10, 25, 50, 80],
    'estoque': [100, 0, 200, 50]
})

print("--- DataFrame original ---")
print(df)
print("\n")

# Produtos com preÃ§o acima de R$ 30
print("--- Produtos com preÃ§o > 30 ---")
print(df[df['preco'] > 30])
print("\n")

# Produtos fora de estoque (igual a 0)
print("--- Produtos sem estoque ---")
print(df[df['estoque'] == 0])
print("\n")

# Produtos com preÃ§o entre R$ 20 e R$ 60 (inclusive)
print("--- Produtos com preÃ§o entre 20 e 60 ---")
print(df[df['preco'].between(20, 60)])
```

**Percebeu a lÃ³gica?** Cada condiÃ§Ã£o que passamos para `df[...]` retorna um novo DataFrame, que Ã© o subconjunto desejado.

-----

## ğŸ§ª DemonstraÃ§Ã£o Aplicada: Resolvendo um Problema Real

Imagine que vocÃª precisa analisar as vendas acima de R$ 300, mas somente da loja 'A'. Ã‰ um problema de mÃºltiplas condiÃ§Ãµes, perfeito para o que acabamos de aprender.

```python
df = pd.DataFrame({
    'dia': ['seg', 'ter', 'qua', 'qui', 'sex'],
    'vendas': [250, 300, 280, 410, 380],
    'loja': ['A', 'A', 'B', 'B', 'A']
})

# Vamos criar a mÃ¡scara booleana em uma variÃ¡vel para maior clareza
print("--- MÃ¡scara booleana ---")
filtro = (df['vendas'] > 300) & (df['loja'] == 'A')
print(filtro)
print("\n")

# Agora aplicamos o filtro para obter o DataFrame
print("--- Resultado filtrado ---")
df_filtrado = df[filtro]
print(df_filtrado)
```

**O que fizemos aqui?**
Primeiro, construÃ­mos nossa "mÃ¡scara" com as duas condiÃ§Ãµes. A primeira parte `(df['vendas'] > 300)` nos diz quais vendas sÃ£o altas, e a segunda `(df['loja'] == 'A')` nos diz quais sÃ£o da loja A. O operador `&` (E) garante que apenas as linhas que satisfazem **ambas** as condiÃ§Ãµes sejam marcadas como `True`. Por fim, passamos a mÃ¡scara para o DataFrame e obtivemos o resultado exato que querÃ­amos.

-----

## ğŸ“ Dicas e Armadilhas: O que o Profissional Faz

  - **ParÃªnteses, sempre\!**: A prioridade de operadores em Python pode gerar erros inesperados se vocÃª esquecer os parÃªnteses em condiÃ§Ãµes compostas. `(condiÃ§Ã£o_1) & (condiÃ§Ã£o_2)` Ã© a Ãºnica forma segura de escrever.
  - **`NaN` e `==`**: A comparaÃ§Ã£o `df['coluna'] == np.nan` **nunca** retorna `True`. Para valores ausentes, use sempre `df['coluna'].isna()`.
  - **Case-sensitive**: O `.isin()` e o operador `==` sÃ£o sensÃ­veis a maiÃºsculas e minÃºsculas. `'a'` Ã© diferente de `'A'`.

-----

## ğŸ”„ TransiÃ§Ãµes e ConexÃµes

  - **Vem de**: A aula anterior, onde vocÃª aprendeu a selecionar dados por rÃ³tulo e posiÃ§Ã£o. A filtragem Ã© um passo alÃ©m: em vez de selecionar pela "localizaÃ§Ã£o" (`.loc[]`), vocÃª seleciona pelo "conteÃºdo" (`df[...]`).
  - **Vai para**: A prÃ³xima aula, que irÃ¡ complementar a filtragem. Com o DataFrame jÃ¡ filtrado, aprenderemos a **ordenÃ¡-lo e agrupÃ¡-lo** para resumir e visualizar as informaÃ§Ãµes de forma ainda mais poderosa.

-----

## ğŸ¨ Recursos Visuais e Mentais (Para Pensar)

1.  **A MÃ¡scara como um "Filtrador"**: Pense na mÃ¡scara booleana como um filtro de cafÃ©: vocÃª passa todos os dados, mas sÃ³ o que atende Ã  condiÃ§Ã£o (o cafÃ© passado) continua para o prÃ³ximo passo.
2.  **O Fluxo de Trabalho (Com a Filtragem)**: Importar â†’ Explorar â†’ Selecionar â†’ **Filtrar (esta aula)** â†’ Analisar â†’ Visualizar.
3.  **Filtragem = Respostas**: A filtragem Ã© o primeiro passo para obter respostas valiosas dos seus dados. Cada filtro Ã© uma pergunta que vocÃª faz ao seu DataFrame.

-----

VocÃª acabou de ganhar um dos poderes mais importantes do Pandas. A filtragem vai ser sua aliada em praticamente todas as suas anÃ¡lises.

Pronto para organizar e resumir seus dados filtrados?

---

# ğŸ§ª ExercÃ­cios

## ğŸ§© Parte 1: Filtragem Simples

1. **Leia o arquivo `dados.csv` e filtre as linhas onde a coluna `'idade'` seja maior que 30.**

2. **Filtre as linhas do DataFrame `clientes.csv` onde a coluna `'cidade'` seja igual a `'SÃ£o Paulo'`.**

3. **Leia o arquivo `produtos.csv` e filtre os produtos com preÃ§o maior que 50.**

4. **Filtre as linhas do DataFrame `vendas.csv` onde a coluna `'vendas'` seja menor ou igual a 300.**

5. **Leia o arquivo `relatorio.csv` e filtre as linhas onde a coluna `'status'` seja `'ativo'`.**

---

## ğŸ” Parte 2: Filtragem com Operadores LÃ³gicos

6. **Filtre as linhas do DataFrame `dados.csv` onde a coluna `'idade'` seja maior que 30 e a coluna `'cidade'` seja `'Rio de Janeiro'`.**

7. **Filtre as linhas do DataFrame `clientes.csv` onde a coluna `'estado'` seja `'SP'` ou `'RJ'`.**

8. **Leia o arquivo `produtos.csv` e filtre os produtos com preÃ§o maior que 20 e estoque menor que 100.**

9. **Filtre as linhas do DataFrame `vendas.csv` onde a coluna `'vendas'` seja maior que 300 ou a coluna `'loja'` seja `'B'`.**

10. **Leia o arquivo `relatorio.csv` e filtre as linhas onde a coluna `'status'` nÃ£o seja `'ativo'`.**

---

## ğŸ§± Parte 3: MÃ©todos `.isin()` e `.between()`

11. **Filtre as linhas do DataFrame `dados.csv` onde a coluna `'cidade'` esteja entre as opÃ§Ãµes `'SÃ£o Paulo'` e `'Rio de Janeiro'` usando `.isin()`.**

12. **Leia o arquivo `produtos.csv` e filtre os produtos com preÃ§o entre 10 e 50 usando `.between()`.**

13. **Filtre as linhas do DataFrame `vendas.csv` onde a coluna `'vendas'` esteja entre 200 e 400 usando `.between()`.**

14. **Leia o arquivo `clientes.csv` e filtre as linhas onde a coluna `'estado'` esteja entre as opÃ§Ãµes `'SP'`, `'RJ'` e `'MG'` usando `.isin()`.**

15. **Filtre as linhas do DataFrame `relatorio.csv` onde a coluna `'data'` esteja entre `'2023-01-01'` e `'2023-12-31'` usando `.between()`.**

---

## ğŸ§¼ Parte 4: Filtragem AvanÃ§ada

16. **Leia o arquivo `dados.csv` e filtre as linhas onde a coluna `'idade'` seja maior que 30 e a coluna `'cidade'` nÃ£o seja `'SÃ£o Paulo'`.**

17. **Filtre as linhas do DataFrame `clientes.csv` onde a coluna `'estado'` seja `'SP'` e a coluna `'idade'` esteja entre 20 e 40.**

18. **Leia o arquivo `produtos.csv` e filtre os produtos com preÃ§o maior que 50 ou estoque igual a 0.**

19. **Filtre as linhas do DataFrame `vendas.csv` onde a coluna `'vendas'` seja maior que 300 e a coluna `'loja'` seja `'A'`.**

20. **Leia o arquivo `relatorio.csv` e filtre as linhas onde a coluna `'status'` seja `'ativo'` e a coluna `'valor'` seja maior que 500.**

---